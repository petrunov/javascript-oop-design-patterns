<!DOCTYPE html>
<html>
<head>
  <title>Undo/Redo example with Command pattern</title>
  <meta charset="UTF-8" />
  <style>
    * {margin: 0; padding: 0;}
    html, body {
      height: 100%;
    }
    button {padding: 2px;}
    #controls {outline: 1px solid black; outline-offset: -1px; background: #ccc;}
    #controls {height: 3%; padding: 10px;}
  </style>

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>


  <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>

  <script src="domToJson.js"></script>
  <script src="stringify.js"></script>
  <script src="hello.json"></script>
  <script src="smiley.json"></script>
  <script src="Commander.js"></script>
  <script src="CreateCmd.js"></script>
  <script src="DragCmd.js"></script>
  <script src="DeleteCmd.js"></script>
  <script src="ResizeCmd.js"></script>
  <script>
    let lastClicked = null

    let player
    let time = 40

    let globalId = 0

    function playReversed() {
      clearInterval(player)
      player = undefined
      player = setInterval(function () {
        if (commander.executed.length === 0) {
          clearInterval(player)
          return
        }
        commander.undo()
      }, time)
    }

    function playForward() {
      clearInterval(player)
      player = undefined
      player = setInterval(function () {
        if (commander.reverted.length === 0) {
          clearInterval(player)
          return
        }
        commander.redo()
      }, time)
    }


    $('document').ready(function() {

      $('body').keydown(function(e) {
        if(e.keyCode === 46 || e.keyCode === 8) {
          commander.execute(Object.assign({}, DeleteCmd), {receiver: lastClicked});
        }
      })

      $('#create').click(clickHandler)
      $('#undo').click(clickHandler)
      $('#redo').click(clickHandler)
      $('#delete').click(clickHandler)

      function clickHandler(e) {
        switch ($(this).attr('id')) {
          case 'create':
            commander.execute(Object.assign({}, CreateCmd))
            break;
          case 'delete':
            commander.execute(Object.assign({}, DeleteCmd), {receiver: lastClicked});
            break;
          case 'undo':
            commander.undo()
            break;
          case 'redo':
            commander.redo()
            break;
        }
      }
    })  
  </script>
</head>
<body>
<div id="controls">
  <button id="create">create</button>
  <button id="delete">delete</button>
  <button id="undo">undo</button>
  <button id="redo">redo</button>
</div>

</body>
</html>